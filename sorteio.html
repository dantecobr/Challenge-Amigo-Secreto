<script>
    // =======================================================
    // 1. DADOS INICIAIS (ATUALIZADOS COM TODOS OS NOMES E ZAPS)
    // ATEN칂츾O: Os n칰meros de J칰lia, Ay칪 e Ravi foram atribu칤dos aos seus respons치veis
    // para que a fun칞칚o de envio funcione. A l칩gica do destinat치rio est치 em getRecipientInfo.
    // =======================================================
    const participantes = [
        { nome: "Ana Clara", zap: "558496634604", amigoSecreto: "" },
        { nome: "Dante Marques", zap: "558496013344", amigoSecreto: "" },
        { nome: "Kallyny", zap: "558487938890", amigoSecreto: "" },
        { nome: "Rodolfo", zap: "558499303180", amigoSecreto: "" },
        { nome: "J칰lia", zap: "558496634604", amigoSecreto: "" }, // 
        { nome: "Ana Maria", zap: "558499101380", amigoSecreto: "" },
        { nome: "Ronaldo", zap: "558487464446", amigoSecreto: "" },
        { nome: "Ton", zap: "558496636715", amigoSecreto: "" },
        { nome: "Anny Kelly", zap: "558487848323", amigoSecreto: "" },
        { nome: "Gl치ucio", zap: "558496104467", amigoSecreto: "" },
        { nome: "Ay칪", zap: "558496104467", amigoSecreto: "" }, // ZAP: Gl치ucio (Ser치 usado como prim치rio)
        { nome: "Ravi", zap: "558499303180", amigoSecreto: "" }  // ZAP: Rodolfo (Ser치 usado como prim치rio)
    ];

    // =======================================================
    // 2. CONFIGURA칂츾O DA URL DE REVELA칂츾O (MANTIDA)
    // =======================================================
    const urlBaseRevelacao = "revelacao.html"; 

    // =======================================================
    // 3. FUN칂츾O DE SORTEIO COM REGRAS FIXAS
    // =======================================================
    function realizarSorteio() {
        if (participantes.length < 2) {
            alert("칄 necess치rio pelo menos dois participantes!");
            return;
        }

        // Reseta os sorteios
        participantes.forEach(p => p.amigoSecreto = "");

        const nomes = participantes.map(p => p.nome);
        
        // Nomes que precisam ser sorteados para algu칠m
        let nomesDisponiveis = [...nomes];

        // 1. APLICAR REGRAS FIXAS
        
        // J칰lia tira Ana Clara
        const julia = participantes.find(p => p.nome === "J칰lia");
        julia.amigoSecreto = "Ana Maria";
        // Remove Ana Clara dos nomes dispon칤veis para ser sorteada
        nomesDisponiveis.splice(nomesDisponiveis.indexOf("Ana Maria"), 1);

        // Rodolfo tira Ronaldo
        const rodolfo = participantes.find(p => p.nome === "Rodolfo");
        rodolfo.amigoSecreto = "Ronaldo";
        // Remove Ronaldo dos nomes dispon칤veis para ser sorteado
        nomesDisponiveis.splice(nomesDisponiveis.indexOf("Ronaldo"), 1);
        
        // Pessoas que j치 tiveram seu Amigo Secreto definido e n칚o precisam ser sorteadas:
        const pessoasJaSorteadas = ["J칰lia", "Rodolfo"];

        // 2. REALIZAR SORTEIO ALEAT칍RIO PARA O RESTANTE

        const participantesParaSortear = participantes.filter(p => !pessoasJaSorteadas.includes(p.nome));
        const nomesQueVaoSortear = participantesParaSortear.map(p => p.nome);
        
        let sucesso = false;
        let tentativas = 0;
        
        while (!sucesso && tentativas < 100) {
            tentativas++;
            // Embaralha apenas os nomes que ainda est칚o dispon칤veis
            const listaEmbaralhada = [...nomesDisponiveis].sort(() => 0.5 - Math.random());
            
            sucesso = true;
            
            // Verifica se o sorteio aleat칩rio 칠 v치lido (ningu칠m tira a si mesmo)
            for (let i = 0; i < participantesParaSortear.length; i++) {
                const pessoa = participantesParaSortear[i];
                const sorteado = listaEmbaralhada[i];
                
                if (pessoa.nome === sorteado) {
                    sucesso = false; // Falhou, tenta novamente
                    break; 
                }
            }

            if (sucesso) {
                // Se for v치lido, atribui os sorteados restantes
                for (let i = 0; i < participantesParaSortear.length; i++) {
                    participantesParaSortear[i].amigoSecreto = listaEmbaralhada[i];
                }
            }
        }
        
        if (tentativas >= 100) {
            alert("Falha no sorteio aleat칩rio ap칩s 100 tentativas. Tente novamente.");
            return;
        }

        // GERA칂츾O DOS LINKS
        gerarLinksWhatsApp();
    }
    
    // =======================================================
    // 4. L칍GICA DE DESTINAT츼RIO (Para crian칞as)
    // =======================================================
    function getRecipientInfo(participante) {
        let recipientName = participante.nome;
        let recipientZap = participante.zap;
        let drawnName = participante.amigoSecreto;
        
        // ----------------------------------------------------
        // L칩gica de Ay칪 (Pais: Gl치ucio e Anny Kelly)
        if (participante.nome === "Ay칪") {
            const glauzio = participantes.find(p => p.nome === "Gl치ucio");
            const anny = participantes.find(p => p.nome === "Anny Kelly");
            
            if (drawnName === "Gl치ucio") {
                // Tira Gl치ucio, envia para Anny Kelly
                recipientName = `Anny Kelly (Respons치vel por Ay칪)`;
                recipientZap = anny.zap;
            } else if (drawnName === "Anny Kelly") {
                // Tira Anny Kelly, envia para Gl치ucio
                recipientName = `Gl치ucio (Respons치vel por Ay칪)`;
                recipientZap = glauzio.zap;
            } else {
                // Tira outra pessoa, envia para Gl치ucio (o prim치rio definido no array)
                recipientName = `Gl치ucio (Respons치vel por Ay칪)`;
                recipientZap = glauzio.zap;
            }
        }

        // ----------------------------------------------------
        // L칩gica de Ravi (Pais: Rodolfo e Enviar para Ana Clara em caso de conflito)
        if (participante.nome === "Ravi") {
            const rodolfo = participantes.find(p => p.nome === "Rodolfo");
            const anamaria = participantes.find(p => p.nome === "Ana Maria");

            if (drawnName === "Rodolfo") {
                // Tira Rodolfo, envia para Ana Clara
                recipientName = `Ana Maria (Respons치vel por Ravi)`;
                recipientZap = anamaria.zap;
            } else {
                // Tira outra pessoa, envia para Rodolfo (o prim치rio definido no array)
                recipientName = `Rodolfo (Respons치vel por Ravi)`;
                recipientZap = rodolfo.zap;
            }
        }

        // ----------------------------------------------------
        // L칩gica de J칰lia (Apenas para garantir que o link seja enviado a um adulto)
        if (participante.nome === "J칰lia") {
            // Assume-se que o ZAP de J칰lia j치 칠 do respons치vel (Ana Clara no array)
            const anamaria = participantes.find(p => p.nome === "Rodolfo");
            recipientName = `Respons치vel por J칰lia`;
            recipientZap = rodolfo.zap;
        }

        return { recipientName, recipientZap, drawnName };
    }
    
    // =======================================================
    // 5. FUN칂츾O DE GERA칂츾O E EXIBI칂츾O DE LINKS
    // =======================================================
    function gerarLinksWhatsApp() {
        const container = document.getElementById('links-de-envio');
        container.innerHTML = ''; // Limpa resultados anteriores

        participantes.forEach(p => {
            const { recipientName, recipientZap, drawnName } = getRecipientInfo(p);
            
            // O nome do amigo secreto 칠 anexado  URL ap칩s o # (hash)
            const linkRevelacao = `${urlBaseRevelacao}#${encodeURIComponent(drawnName)}`;
            
            // Mensagem a ser enviada pelo WhatsApp (codificada para URL)
            const mensagem = `游봅 Ol치, ${recipientName}! Voc칡 est치 recebendo o link do Amigo Secreto de *${p.nome}*. O Amigo Secreto sorteado para ${p.nome} 칠: ${linkRevelacao}%0A%0A_Aten칞칚o: N칚o compartilhe este link!_`; // %0A 칠 uma quebra de linha
            
            // Cria o link final wa.me
            const linkWhatsApp = `https://wa.me/${recipientZap}?text=${encodeURIComponent(mensagem)}`;

            // Exibe o link na tela
            const divElement = document.createElement('div');
            divElement.classList.add('link-pronto');
            divElement.innerHTML = `
                <p><strong>Para: ${p.nome}</strong> | Destinat치rio do Zap: <strong>${recipientName}</strong></p>
                <a href="${linkWhatsApp}" target="_blank">Clique para Abrir o WhatsApp e Enviar</a>
                <p style="font-size: 0.8em; margin-top: 5px;">Link Gerado: <code>${linkRevelacao}</code></p>
            `;
            container.appendChild(divElement);
        });
    }
</script>
